
# App owners would either need to chown the entire agent folder to their app's user  OR grant their app's user read/write access to the agent folder 
- name: Ensures application agent {{java_agent_dest_folder_linux}} dir exists
  file: 
    path: "{{ java_agent_dest_folder_linux }}/"
    state: directory     
    mode: 0755
    recurse: yes
  
- name: Downloading Java Agent to target
  get_url:
    url: '{{ agent_download_url.stdout }}'
    dest: '{{ java_agent_dest_folder_linux }}/{{ java_agent_dest_file }}'
    force: 'true'

- name: Unarchive the application agent file
  unarchive: 
    src: "{{ java_agent_dest_folder_linux }}/{{ java_agent_dest_file }}"
    dest: "{{ java_agent_dest_folder_linux }}"   
    copy: no

- name: Install java-agent config
  template:
    src: templates/application-agent-controller-info.xml.j2
    dest: '{{ java_agent_dest_folder_linux }}/conf/controller-info.xml'
    mode: 0755  

#- name: Verify java agent config
#  command: less  '{{ java_agent_dest_folder_linux }}/conf/controller-info.xml'
#  register: content
#  ignore_errors: yes

#- name: Show config file content
#  debug:
#    var: content

- name: Clean up - remove {{ java_agent_dest_file }} 
  file:
    path: "{{ java_agent_dest_folder_linux }}/{{ java_agent_dest_file }}"
    state: absent
